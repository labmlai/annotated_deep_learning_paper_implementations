<!DOCTYPE html>
<html lang="si">
<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="‡∂∏‡∑ö‡∑Ä‡∑è ‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂∏‡∂≠ ‡∂¥‡∂Ø‡∂±‡∂∏‡∑ä ‡∑Ä‡∑ñ ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í ‡∂∏‡∑ô‡∂±‡∑ä‡∂∏ ‡∑Ä‡∑ô‡∂±‡∂≠‡∑ä ‡∂Ü‡∑Å‡∑ä‡∂ª‡∑í‡∂≠ ‡∂∏‡∑ú‡∂©‡∑í‡∂∫‡∑î‡∂Ω‡∑Ä‡∂Ω ‡∂¥‡∂∫‡∑í‡∂ß‡∑ù‡∂†‡∑ä ‡∂ö‡∑ä‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ä ‡∑Ä‡∑ö."/>

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image:src" content="https://avatars1.githubusercontent.com/u/64068543?s=400&amp;v=4"/>
    <meta name="twitter:title" content="‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í"/>
    <meta name="twitter:description" content="‡∂∏‡∑ö‡∑Ä‡∑è ‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂∏‡∂≠ ‡∂¥‡∂Ø‡∂±‡∂∏‡∑ä ‡∑Ä‡∑ñ ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í ‡∂∏‡∑ô‡∂±‡∑ä‡∂∏ ‡∑Ä‡∑ô‡∂±‡∂≠‡∑ä ‡∂Ü‡∑Å‡∑ä‡∂ª‡∑í‡∂≠ ‡∂∏‡∑ú‡∂©‡∑í‡∂∫‡∑î‡∂Ω‡∑Ä‡∂Ω ‡∂¥‡∂∫‡∑í‡∂ß‡∑ù‡∂†‡∑ä ‡∂ö‡∑ä‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ä ‡∑Ä‡∑ö."/>
    <meta name="twitter:site" content="@labmlai"/>
    <meta name="twitter:creator" content="@labmlai"/>

    <meta property="og:url" content="https://nn.labml.ai/transformers/models.html"/>
    <meta property="og:title" content="‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í"/>
    <meta property="og:image" content="https://avatars1.githubusercontent.com/u/64068543?s=400&amp;v=4"/>
    <meta property="og:site_name" content="‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í"/>
    <meta property="og:description" content="‡∂∏‡∑ö‡∑Ä‡∑è ‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂∏‡∂≠ ‡∂¥‡∂Ø‡∂±‡∂∏‡∑ä ‡∑Ä‡∑ñ ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í ‡∂∏‡∑ô‡∂±‡∑ä‡∂∏ ‡∑Ä‡∑ô‡∂±‡∂≠‡∑ä ‡∂Ü‡∑Å‡∑ä‡∂ª‡∑í‡∂≠ ‡∂∏‡∑ú‡∂©‡∑í‡∂∫‡∑î‡∂Ω‡∑Ä‡∂Ω ‡∂¥‡∂∫‡∑í‡∂ß‡∑ù‡∂†‡∑ä ‡∂ö‡∑ä‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ä ‡∑Ä‡∑ö."/>

    <title>‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í</title>
    <link rel="shortcut icon" href="/icon.png"/>
    <link rel="stylesheet" href="../pylit.css?v=1">
    <link rel="canonical" href="https://nn.labml.ai/transformers/models.html"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css" integrity="sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET" crossorigin="anonymous">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4V3HC8HBLH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-4V3HC8HBLH');
    </script>
</head>
<body>
<div id='container'>
    <div id="background"></div>
    <div class='section'>
        <div class='docs'>
            <p>
                <a class="parent" href="/">home</a>
                <a class="parent" href="index.html">transformers</a>
            </p>
            <p>
                <a href="https://github.com/labmlai/annotated_deep_learning_paper_implementations" target="_blank">
                    <img alt="Github"
                         src="https://img.shields.io/github/stars/labmlai/annotated_deep_learning_paper_implementations?style=social"
                         style="max-width:100%;"/></a>
                <a href="https://twitter.com/labmlai" rel="nofollow" target="_blank">
                    <img alt="Twitter"
                         src="https://img.shields.io/twitter/follow/labmlai?style=social"
                         style="max-width:100%;"/></a>
            </p>
            <p>
                <a href="https://github.com/labmlai/annotated_deep_learning_paper_implementations/tree/master/labml_nn/transformers/models.py" target="_blank">
                    View code on Github</a>
            </p>
        </div>
    </div>
    <div class='section' id='section-0'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-0'>#</a>
            </div>
            <h1>‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂Ü‡∂ö‡∑ò‡∂≠‡∑í</h1>
<p><a href="https://colab.research.google.com/github/labmlai/annotated_deep_learning_paper_implementations/blob/master/labml_nn/transformers/basic/autoregressive_experiment.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg"></a></p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">13</span><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="lineno">14</span>
<span class="lineno">15</span><span class="kn">import</span> <span class="nn">torch</span>
<span class="lineno">16</span><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="lineno">17</span>
<span class="lineno">18</span><span class="kn">from</span> <span class="nn">labml_nn.utils</span> <span class="kn">import</span> <span class="n">clone_module_list</span>
<span class="lineno">19</span><span class="kn">from</span> <span class="nn">.feed_forward</span> <span class="kn">import</span> <span class="n">FeedForward</span>
<span class="lineno">20</span><span class="kn">from</span> <span class="nn">.mha</span> <span class="kn">import</span> <span class="n">MultiHeadAttention</span>
<span class="lineno">21</span><span class="kn">from</span> <span class="nn">.positional_encoding</span> <span class="kn">import</span> <span class="n">get_positional_encoding</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-1'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-1'>#</a>
            </div>
            <p> <a id="EmbeddingsWithPositionalEncoding"></a></p>
<h2>‡∂ß‡∑ù‡∂ö‡∂±‡∂ö‡∑è‡∑Ä‡∑ê‡∂Ø‡∑ä‡∂Ø‡∑ì‡∂∏ ‡∑É‡∑Ñ <a href="positional_encoding.html">‡∑É‡∑ä‡∂Æ‡∑è‡∑Ä‡∂ª ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∑ì‡∂∫ ‡∂ö‡∑ö‡∂≠‡∑ì‡∂ö‡∂ª‡∂´</a>‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</h2>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">24</span><span class="k">class</span> <span class="nc">EmbeddingsWithPositionalEncoding</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-2'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-2'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">31</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_vocab</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">):</span>
<span class="lineno">32</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="lineno">33</span>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">n_vocab</span><span class="p">,</span> <span class="n">d_model</span><span class="p">)</span>
<span class="lineno">34</span>        <span class="bp">self</span><span class="o">.</span><span class="n">d_model</span> <span class="o">=</span> <span class="n">d_model</span>
<span class="lineno">35</span>        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s1">&#39;positional_encodings&#39;</span><span class="p">,</span> <span class="n">get_positional_encoding</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">max_len</span><span class="p">))</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-3'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-3'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">37</span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<span class="lineno">38</span>        <span class="n">pe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positional_encodings</span><span class="p">[:</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="lineno">39</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_model</span><span class="p">)</span> <span class="o">+</span> <span class="n">pe</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-4'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-4'>#</a>
            </div>
            <p> <a id="EmbeddingsWithLearnedPositionalEncoding"></a></p>
<h2>‡∂ß‡∑ù‡∂ö‡∂±‡∂ö‡∑è‡∑Ä‡∑ê‡∂Ø‡∑ä‡∂Ø‡∑ì‡∂∏ ‡∑É‡∑Ñ ‡∂¥‡∂ª‡∑è‡∂∏‡∑í‡∂≠‡∑í‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∑Ö ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∑ì‡∂∫ ‡∂ö‡∑ö‡∂≠‡∑ì‡∂ö‡∂ª‡∂´ ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</h2>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">42</span><span class="k">class</span> <span class="nc">EmbeddingsWithLearnedPositionalEncoding</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-5'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-5'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">49</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_vocab</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">):</span>
<span class="lineno">50</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="lineno">51</span>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">n_vocab</span><span class="p">,</span> <span class="n">d_model</span><span class="p">)</span>
<span class="lineno">52</span>        <span class="bp">self</span><span class="o">.</span><span class="n">d_model</span> <span class="o">=</span> <span class="n">d_model</span>
<span class="lineno">53</span>        <span class="bp">self</span><span class="o">.</span><span class="n">positional_encodings</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d_model</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-6'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-6'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">55</span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<span class="lineno">56</span>        <span class="n">pe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positional_encodings</span><span class="p">[:</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="lineno">57</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_model</span><span class="p">)</span> <span class="o">+</span> <span class="n">pe</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-7'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-7'>#</a>
            </div>
            <p> <a id="TransformerLayer"></a></p>
<h2>‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä‡∑É‡∑ä‡∂Æ‡∂ª‡∂∫</h2>
<p>‡∂∏‡∑ô‡∂∫‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∂≠‡∂ß‡∑ä‡∂ß‡∑î‡∑Ä‡∂ö‡∑ä ‡∑Ñ‡∑ù ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂≠‡∂ß‡∑ä‡∂ß‡∑î‡∑Ä‡∂ö‡∑ä ‡∂Ω‡∑ô‡∑É ‡∂ö‡∑ä‡∂ª‡∑í‡∂∫‡∑è ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö‡∑í‡∂∫. </p>
<p>üóí‡∂ö‡∂©‡∂Ø‡∑è‡∑É‡∑í ‡∂á‡∂≠‡∑î‡∑Ö‡∑î ‡∑É‡∂∏‡∑Ñ‡∂ª ‡∂ö‡∑ä‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ä, ‡∑É‡∑ä‡∂Æ‡∂ª-‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∑É‡∑í‡∂Ø‡∑î ‡∂ö‡∂ª‡∂± ‡∑É‡∑ä‡∂Æ‡∑è‡∂±‡∂∫‡∑ö ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä‡∂ö‡∂∏‡∑ä ‡∂á‡∂≠‡∑í ‡∂∂‡∑Ä ‡∂¥‡∑ô‡∂±‡∑ö. ‡∂∏‡∑ô‡∂±‡∑ä‡∂± ‡∂Ö‡∂¥‡∑í ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∑É‡∑Ñ ‡∂¥‡∑ù‡∑Ç‡∂ö ‡∂â‡∂Ø‡∑í‡∂ª‡∑í‡∂∫‡∂ß ‡∂¢‡∑è‡∂Ω ‡∂¥‡∑ô‡∂ª ‡∑É‡∑ä‡∂Æ‡∂ª‡∂∫‡∂ö‡∑ä ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±, ‡∑É‡∑Ñ ‡∂∏‡∑î‡∂Ω‡∑ä ‡∂Ö‡∑Ä‡∑Å‡∑ö‡∑Ç ‡∂Ø‡∑õ‡∑Å‡∑í‡∂ö ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±. ‡∑Ä‡∑í‡∂ö‡∂Ω‡∑ä‡∂¥‡∂∫‡∂ö‡∑ä ‡∑Ä‡∂±‡∑ä‡∂±‡∑ö ‡∂Ö‡∂¥‡∂Ø‡∑ä‡∂ª‡∑Ä‡∑ä‡∂∫ ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ô‡∂±‡∑ä ‡∂¥‡∑É‡∑î ‡∑É‡∑ä‡∂Æ‡∂ª ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂∫‡∑í. ‡∂±‡∂∏‡∑î‡∂≠‡∑ä ‡∂¥‡∑î‡∑Ñ‡∑î‡∂´‡∑î‡∑Ä‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂∏‡∑ô‡∂∫ ‡∂Ö‡∂©‡∑î ‡∑É‡∑ä‡∂Æ‡∑è‡∑Ä‡∂ª ‡∂∂‡∑Ä ‡∂Ö‡∂¥‡∂ß ‡∂¥‡∑ô‡∂±‡∑ì ‡∂ú‡∑í‡∂∫‡∑ö‡∂∫. <a href="https://papers.labml.ai/paper/2002.04745">‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∂ú‡∑ò‡∑Ñ ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´ ‡∑Å‡∑í‡∂Ω‡∑ä‡∂¥‡∂∫‡∑ö ON Layer ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥</a>‡∂¥‡∂≠‡∑ä‡∂ª‡∑í‡∂ö‡∑è‡∑Ä‡∑ö ‡∂∏‡∑ö ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥‡∑Ä ‡∑É‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∑É‡∑è‡∂ö‡∂†‡∑ä‡∂°‡∑è‡∑Ä‡∂ö‡∑ä ‡∂Ö‡∂¥‡∂ß ‡∑Ñ‡∂∏‡∑î ‡∑Ä‡∑í‡∂∫. </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">60</span><span class="k">class</span> <span class="nc">TransformerLayer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-8'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-8'>#</a>
            </div>
            <ul><li><code  class="highlight"><span></span><span class="n">d_model</span></code>
 ‡∂ß‡∑ù‡∂ö‡∂±‡∂∫ ‡∂ö‡∑è‡∑Ä‡∑ê‡∂Ø‡∑ä‡∂Ø‡∑ì‡∂∏‡∑ö ‡∂¥‡∑ä‡∂ª‡∂∏‡∑è‡∂´‡∂∫‡∂∫‡∑í </li>
<li><code  class="highlight"><span></span><span class="n">self_attn</span></code>
 ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∂∏‡∑ú‡∂©‡∑í‡∂∫‡∑î‡∂Ω‡∂∫ </li>
<li><code  class="highlight"><span></span><span class="n">src_attn</span></code>
 ‡∂∫‡∂±‡∑î ‡∂¥‡∑ä‡∂ª‡∂∑‡∑Ä ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∂∫‡∑ú‡∂∏‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂∏‡∑ú‡∂©‡∑í‡∂∫‡∑î‡∂Ω‡∂∫ (‡∂∏‡∑ô‡∂∫ ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö‡∂∫‡∂ö‡∑ä ‡∂≠‡∑î‡∑Ö ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂± ‡∑Ä‡∑í‡∂ß) </li>
<li><code  class="highlight"><span></span><span class="n">feed_forward</span></code>
 ‡∂∫‡∂±‡∑î ‡∂Ü‡∑Ñ‡∑è‡∂ª ‡∂â‡∂Ø‡∑í‡∂ª‡∑í ‡∂∏‡∑ú‡∂©‡∑í‡∂∫‡∑î‡∂Ω‡∂∫‡∂∫‡∑í </li>
<li><code  class="highlight"><span></span><span class="n">dropout_prob</span></code>
 ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑É‡∑î ‡∂â‡∑Ä‡∂≠‡∑ä ‡∑Ä‡∑ì‡∂∏‡∑ö ‡∑É‡∂∏‡∑ä‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è‡∑Ä ‡∑É‡∑Ñ FFN</li></ul>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">78</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
<span class="lineno">79</span>                 <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="lineno">80</span>                 <span class="n">self_attn</span><span class="p">:</span> <span class="n">MultiHeadAttention</span><span class="p">,</span>
<span class="lineno">81</span>                 <span class="n">src_attn</span><span class="p">:</span> <span class="n">MultiHeadAttention</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="lineno">82</span>                 <span class="n">feed_forward</span><span class="p">:</span> <span class="n">FeedForward</span><span class="p">,</span>
<span class="lineno">83</span>                 <span class="n">dropout_prob</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-9'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-9'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">91</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="lineno">92</span>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">d_model</span>
<span class="lineno">93</span>        <span class="bp">self</span><span class="o">.</span><span class="n">self_attn</span> <span class="o">=</span> <span class="n">self_attn</span>
<span class="lineno">94</span>        <span class="bp">self</span><span class="o">.</span><span class="n">src_attn</span> <span class="o">=</span> <span class="n">src_attn</span>
<span class="lineno">95</span>        <span class="bp">self</span><span class="o">.</span><span class="n">feed_forward</span> <span class="o">=</span> <span class="n">feed_forward</span>
<span class="lineno">96</span>        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_prob</span><span class="p">)</span>
<span class="lineno">97</span>        <span class="bp">self</span><span class="o">.</span><span class="n">norm_self_attn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">([</span><span class="n">d_model</span><span class="p">])</span>
<span class="lineno">98</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_attn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="lineno">99</span>            <span class="bp">self</span><span class="o">.</span><span class="n">norm_src_attn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">([</span><span class="n">d_model</span><span class="p">])</span>
<span class="lineno">100</span>        <span class="bp">self</span><span class="o">.</span><span class="n">norm_ff</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">([</span><span class="n">d_model</span><span class="p">])</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-10'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-10'>#</a>
            </div>
            <p>‡∂Ü‡∑Ñ‡∑è‡∂ª‡∂â‡∂Ø‡∑í‡∂ª‡∑í ‡∑É‡∑ä‡∂Æ‡∂ª‡∂∫‡∂ß ‡∂Ü‡∂Ø‡∑è‡∂±‡∂∫ ‡∂â‡∂≠‡∑í‡∂ª‡∑í ‡∂ö‡∂ª ‡∂ú‡∂≠ ‡∂∫‡∑î‡∂≠‡∑î‡∂Ø ‡∂∫‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">102</span>        <span class="bp">self</span><span class="o">.</span><span class="n">is_save_ff_input</span> <span class="o">=</span> <span class="kc">False</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-11'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-11'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">104</span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
<span class="lineno">105</span>                <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<span class="lineno">106</span>                <span class="n">mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<span class="lineno">107</span>                <span class="n">src</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="lineno">108</span>                <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-12'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-12'>#</a>
            </div>
            <p>‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∂∫‡∑ú‡∂∏‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂¥‡∑ô‡∂ª ‡∂Ø‡∑õ‡∑Å‡∑í‡∂ö ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">110</span>        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_self_attn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-13'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-13'>#</a>
            </div>
            <p>‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂∞‡∑è‡∑Ä‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±, i.e. ‡∂∫‡∂≠‡∑î‡∂ª‡∑î ‡∑É‡∑Ñ ‡∑Ä‡∂ß‡∑í‡∂±‡∑è‡∂ö‡∂∏‡∑ä ‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç ‡∑É‡∑í‡∂ß </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">112</span>        <span class="n">self_attn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_attn</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-14'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-14'>#</a>
            </div>
            <p>‡∑É‡∑ä‡∑Ä‡∂∫‡∂Ç‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∂¥‡∑ä‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω ‡∂ë‡∂ö‡∂≠‡∑î </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">114</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">self_attn</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-15'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-15'>#</a>
            </div>
            <p>‡∂¥‡∑ä‡∂ª‡∂∑‡∑Ä‡∂∫‡∂ö‡∑ä‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∂∏‡∑ä, ‡∂¥‡∑ä‡∂ª‡∂∑‡∑Ä‡∂∫‡∂ß ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∂∫‡∑ú‡∂∏‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ô‡∂±‡∑ä ‡∂¥‡∑ä‡∂ª‡∂≠‡∑í results ‡∂Ω ‡∂Ω‡∂∂‡∑è ‡∂ú‡∂±‡∑ä‡∂±. ‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∑ä ‡∂¥‡∑ä‡∂ª‡∂≠‡∑í‡∂Ø‡∑è‡∂±‡∂∫‡∂±‡∑ä ‡∂ö‡∑ô‡∂ª‡∑ô‡∑Ñ‡∑í ‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∂∫‡∑ú‡∂∏‡∑î ‡∂ö‡∂ª‡∂± ‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö ‡∂≠‡∂ß‡∑ä‡∂ß‡∑î‡∑Ä‡∂ö‡∑ä ‡∂î‡∂∂‡∂ß ‡∂á‡∂≠‡∑í ‡∑Ä‡∑í‡∂ß ‡∂∏‡∑ô‡∂∫ </p>‡∑Ä‡∑ö

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">119</span>        <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-16'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-16'>#</a>
            </div>
            <p>‡∂Ø‡∑õ‡∑Å‡∑í‡∂ö‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">121</span>            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_src_attn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-17'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-17'>#</a>
            </div>
            <p>‡∂¥‡∑ä‡∂ª‡∂∑‡∑Ä‡∂∫‡∂ß‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∂∫‡∑ú‡∂∏‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±. ‡∂ë‡∂±‡∂∏‡∑ä ‡∂∫‡∂≠‡∑î‡∂ª‡∑î ‡∑É‡∑Ñ ‡∂Ö‡∂ú‡∂∫‡∂±‡∑ä ‡∂¥‡∑ä‡∂ª‡∂∑‡∑Ä‡∂∫‡∑ô‡∂±‡∑ä ‡∑Ä‡∑ö </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">123</span>            <span class="n">attn_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_attn</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-18'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-18'>#</a>
            </div>
            <p>‡∂∏‡∑ñ‡∂Ω‡∑è‡∑Å‡∑ä‡∂ª‡∂Ö‡∑Ä‡∂∞‡∑è‡∂±‡∂∫ ‡∂∫‡∑ú‡∂∏‡∑î ‡∂¥‡∑ä‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">125</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">attn_src</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-19'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-19'>#</a>
            </div>
            <p>‡∂¥‡∑ù‡∑Ç‡∂´‡∂∫‡∑É‡∂≥‡∑Ñ‡∑è ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">128</span>        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_ff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-20'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-20'>#</a>
            </div>
            <p>‡∂±‡∑í‡∑Å‡∑ä‡∂†‡∑í‡∂≠‡∑Ä‡∂Ø‡∂ö‡∑ä‡∑Ä‡∑è ‡∂á‡∂≠‡∑ä‡∂±‡∂∏‡∑ä ‡∂Ü‡∂Ø‡∑è‡∂±‡∂∫ ‡∂Ü‡∑Ñ‡∑è‡∂ª ‡∂â‡∂Ø‡∑í‡∂ª‡∑í ‡∑É‡∑ä‡∂Æ‡∂ª‡∂∫‡∂ß ‡∑É‡∑î‡∂ª‡∂ö‡∑í‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">130</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_save_ff_input</span><span class="p">:</span>
<span class="lineno">131</span>            <span class="bp">self</span><span class="o">.</span><span class="n">ff_input</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-21'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-21'>#</a>
            </div>
            <p>Feed-forward‡∂¢‡∑è‡∂Ω‡∂∫ ‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂ú‡∂∏‡∂±‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">133</span>        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_forward</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-22'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-22'>#</a>
            </div>
            <p>‡∂¥‡∑ä‡∂ª‡∂≠‡∑í‡∂¥‡∑ù‡∑Ç‡∂´‡∂â‡∂Ø‡∑í‡∂ª‡∑í ‡∂¥‡∑ä‡∂ª‡∂≠‡∑í results ‡∂Ω ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">135</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
<span class="lineno">136</span>
<span class="lineno">137</span>        <span class="k">return</span> <span class="n">x</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-23'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-23'>#</a>
            </div>
            <p> <a id="Encoder"></a></p>
<h2>‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∂∫</h2>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">140</span><span class="k">class</span> <span class="nc">Encoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-24'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-24'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">147</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">:</span> <span class="n">TransformerLayer</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="lineno">148</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-25'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-25'>#</a>
            </div>
            <p>‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä‡∑É‡∑ä‡∂Æ‡∂ª‡∂∫‡∑ö ‡∂¥‡∑í‡∂ß‡∂¥‡∂≠‡∑ä ‡∑É‡∑è‡∂Ø‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">150</span>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">clone_module_list</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-26'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-26'>#</a>
            </div>
            <p>‡∂Ö‡∑Ä‡∑É‡∑è‡∂±‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´ ‡∑É‡∑ä‡∂≠‡∂ª‡∂∫ </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">152</span>        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">([</span><span class="n">layer</span><span class="o">.</span><span class="n">size</span><span class="p">])</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-27'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-27'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">154</span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-28'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-28'>#</a>
            </div>
            <p>‡∂ë‡∂ö‡∑ä‡∂ë‡∂ö‡∑ä ‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∑É‡∑ä‡∂Æ‡∂ª‡∂∫ ‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂∞‡∑è‡∑Ä‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">156</span>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<span class="lineno">157</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-29'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-29'>#</a>
            </div>
            <p>‡∂Ö‡∑Ä‡∑É‡∑è‡∂±‡∑Ä‡∑Å‡∂∫‡∑ô‡∂±‡∑ä, ‡∂Ø‡∑õ‡∑Å‡∑í‡∂ö ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">159</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-30'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-30'>#</a>
            </div>
            <p> <a id="Decoder"></a></p>
<h2>‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö‡∂∫</h2>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">162</span><span class="k">class</span> <span class="nc">Decoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-31'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-31'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">169</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">:</span> <span class="n">TransformerLayer</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="lineno">170</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-32'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-32'>#</a>
            </div>
            <p>‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä‡∑É‡∑ä‡∂Æ‡∂ª‡∂∫‡∑ö ‡∂¥‡∑í‡∂ß‡∂¥‡∂≠‡∑ä ‡∑É‡∑è‡∂Ø‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">172</span>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">clone_module_list</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-33'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-33'>#</a>
            </div>
            <p>‡∂Ö‡∑Ä‡∑É‡∑è‡∂±‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´ ‡∑É‡∑ä‡∂≠‡∂ª‡∂∫ </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">174</span>        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">([</span><span class="n">layer</span><span class="o">.</span><span class="n">size</span><span class="p">])</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-34'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-34'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">176</span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">memory</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">tgt_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-35'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-35'>#</a>
            </div>
            <p>‡∂ë‡∂ö‡∑ä‡∂ë‡∂ö‡∑ä ‡∂ß‡∑ä‡∂ª‡∑è‡∂±‡∑ä‡∑É‡∑ä‡∑Ü‡∑ù‡∂∏‡∂ª‡∑ä ‡∑É‡∑ä‡∂Æ‡∂ª‡∂∫ ‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂∞‡∑è‡∑Ä‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">178</span>        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<span class="lineno">179</span>            <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">tgt_mask</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span> <span class="n">src_mask</span><span class="o">=</span><span class="n">src_mask</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-36'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-36'>#</a>
            </div>
            <p>‡∂Ö‡∑Ä‡∑É‡∑è‡∂±‡∑Ä‡∑Å‡∂∫‡∑ô‡∂±‡∑ä, ‡∂Ø‡∑õ‡∑Å‡∑í‡∂ö ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‡∂∫‡∂ö‡∂ª‡∂´‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">181</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-37'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-37'>#</a>
            </div>
            <p> <a id="Generator"></a></p>
<h2>‡∂ã‡∂≠‡∑ä‡∂¥‡∑è‡∂Ø‡∂ö‡∂∫‡∂±‡∑ä‡∂≠‡∑ä‡∂ª‡∂∫</h2>
<p>‡∂∏‡∑ô‡∂∫‡∂ß‡∑ù‡∂ö‡∂± ‡∂¥‡∑î‡∂ª‡∑ù‡∂ö‡∂Æ‡∂±‡∂∫ ‡∂ö‡∂ª‡∂± ‡∂Ö‡∂≠‡∂ª ‡∂ë‡∂∏ ‡∂Ö‡∂∫‡∂ú‡∑ö ‡∑É‡∑ú‡∑Ü‡∑ä‡∂ß‡∑ä‡∂∏‡∑ê‡∂ö‡∑ä‡∑É‡∑ä ‡∂Ω‡∂∂‡∑è ‡∂Ø‡∑ô‡∂∫‡∑í. ‡∂î‡∂∂ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∂∏‡∑ä ‡∂î‡∂∂‡∂ß ‡∂∏‡∑ô‡∂∫ ‡∂Ö‡∑Ä‡∑Å‡∑ä‡∂∫ ‡∂±‡∑ú‡∑Ä‡∑ö <code  class="highlight"><span></span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span></code>
. </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">184</span><span class="k">class</span> <span class="nc">Generator</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-38'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-38'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">194</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_vocab</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="lineno">195</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="lineno">196</span>        <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">n_vocab</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-39'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-39'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">198</span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="lineno">199</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-40'>
        <div class='docs doc-strings'>
            <div class='section-link'>
                <a href='#section-40'>#</a>
            </div>
            <p> <a id="EncoderDecoder"></a></p>
<h2>‡∂í‡∂ö‡∑è‡∂∂‡∂Ø‡∑ä‡∂∞‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∂∫-‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö‡∂∫</h2>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">202</span><span class="k">class</span> <span class="nc">EncoderDecoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-41'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-41'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">209</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoder</span><span class="p">:</span> <span class="n">Encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">:</span> <span class="n">Decoder</span><span class="p">,</span> <span class="n">src_embed</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">tgt_embed</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="lineno">210</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="lineno">211</span>        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">encoder</span>
<span class="lineno">212</span>        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">decoder</span>
<span class="lineno">213</span>        <span class="bp">self</span><span class="o">.</span><span class="n">src_embed</span> <span class="o">=</span> <span class="n">src_embed</span>
<span class="lineno">214</span>        <span class="bp">self</span><span class="o">.</span><span class="n">tgt_embed</span> <span class="o">=</span> <span class="n">tgt_embed</span>
<span class="lineno">215</span>        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-42'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-42'>#</a>
            </div>
            <p>‡∂∏‡∑ô‡∂∫‡∂î‡∑Ä‡∑î‡∂±‡∑ä‡∂ú‡∑ö ‡∂ö‡∑ö‡∂≠‡∂∫‡∑ô‡∂±‡∑ä ‡∑Ä‡∑ê‡∂Ø‡∂ú‡∂≠‡∑ä ‡∑Ä‡∑í‡∂∫. ‡∂ú‡∑ä‡∂Ω‡∑ù‡∂ª‡∑ù‡∂ß‡∑ä/fan_avg ‡∑É‡∂∏‡∂ü ‡∂¥‡∂ª‡∑è‡∂∏‡∑í‡∂≠‡∑ì‡∂±‡∑ä ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±. </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">219</span>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
<span class="lineno">220</span>            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="lineno">221</span>                <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">xavier_uniform_</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-43'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-43'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">223</span>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">tgt</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">tgt_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-44'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-44'>#</a>
            </div>
            <p>‡∂ë‡∂±‡∑ä‡∂ö‡∑ù‡∂©‡∂ª‡∂∫‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂¥‡∑ä‡∂ª‡∂∑‡∑Ä‡∂∫ ‡∂∞‡∑è‡∑Ä‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">225</span>        <span class="n">enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-45'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-45'>#</a>
            </div>
            <p>‡∑Ä‡∑í‡∂ö‡∑ö‡∂≠‡∂ö‡∂∫‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂ö‡∑ö‡∂≠‡∑ì‡∂ö‡∂ª‡∂´ ‡∑É‡∑Ñ ‡∂â‡∂Ω‡∂ö‡∑ä‡∂ö ‡∂∞‡∑è‡∑Ä‡∂±‡∂∫ ‡∂ö‡∂ª‡∂±‡∑ä‡∂± </p>

        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">227</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">tgt_mask</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-46'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-46'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">229</span>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<span class="lineno">230</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src_embed</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="n">src_mask</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='section' id='section-47'>
        <div class='docs'>
            <div class='section-link'>
                <a href='#section-47'>#</a>
            </div>
            
        </div>
        <div class='code'>
            <div class="highlight"><pre><span class="lineno">232</span>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">tgt</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">tgt_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<span class="lineno">233</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tgt_embed</span><span class="p">(</span><span class="n">tgt</span><span class="p">),</span> <span class="n">memory</span><span class="p">,</span> <span class="n">src_mask</span><span class="p">,</span> <span class="n">tgt_mask</span><span class="p">)</span></pre></div>
        </div>
    </div>
    <div class='footer'>
        <a href="https://papers.labml.ai">Trending Research Papers</a>
        <a href="https://labml.ai">labml.ai</a>
    </div>
</div>
<script src=../interactive.js?v=1"></script>
<script>
    function handleImages() {
        var images = document.querySelectorAll('p>img')

        for (var i = 0; i < images.length; ++i) {
            handleImage(images[i])
        }
    }

    function handleImage(img) {
        img.parentElement.style.textAlign = 'center'

        var modal = document.createElement('div')
        modal.id = 'modal'

        var modalContent = document.createElement('div')
        modal.appendChild(modalContent)

        var modalImage = document.createElement('img')
        modalContent.appendChild(modalImage)

        var span = document.createElement('span')
        span.classList.add('close')
        span.textContent = 'x'
        modal.appendChild(span)

        img.onclick = function () {
            console.log('clicked')
            document.body.appendChild(modal)
            modalImage.src = img.src
        }

        span.onclick = function () {
            document.body.removeChild(modal)
        }
    }

    handleImages()
</script>
</body>
</html>